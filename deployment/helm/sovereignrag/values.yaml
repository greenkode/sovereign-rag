# Default values for sovereignrag

global:
  license:
    key: "" # REQUIRED: Your SovereignRAG license key

# Image configuration
image:
  registry: docker.io
  repository: sovereignrag
  pullPolicy: IfNotPresent
  tag: "latest"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# Core Microservice
corems:
  enabled: true
  replicaCount: 2
  image:
    repository: sovereignrag/core-ms
    pullPolicy: IfNotPresent
    tag: ""

  service:
    type: ClusterIP
    port: 8000

  resources:
    limits:
      cpu: 4000m
      memory: 8Gi
    requests:
      cpu: 2000m
      memory: 4Gi

  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  env:
    SPRING_PROFILES_ACTIVE: "production"
    ADMIN_ENABLED: "true"
    DEV_TENANT_ENABLED: "false"
    GUARDRAILS_ENABLED: "true"
    USE_RERANKING: "true"

  ingress:
    enabled: true
    className: "nginx"
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      nginx.ingress.kubernetes.io/proxy-body-size: "100m"
    hosts:
      - host: api.sovereignrag.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: sovereignrag-tls
        hosts:
          - api.sovereignrag.example.com

# Identity Microservice
identityms:
  enabled: true
  replicaCount: 2
  image:
    repository: sovereignrag/identity-ms
    pullPolicy: IfNotPresent
    tag: ""

  service:
    type: ClusterIP
    port: 9093

  resources:
    limits:
      cpu: 2000m
      memory: 4Gi
    requests:
      cpu: 1000m
      memory: 2Gi

  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70

  ingress:
    enabled: true
    className: "nginx"
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
    hosts:
      - host: identity.sovereignrag.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: identity-tls
        hosts:
          - identity.sovereignrag.example.com

# Audit Microservice
auditms:
  enabled: true
  replicaCount: 1
  image:
    repository: sovereignrag/audit-ms
    pullPolicy: IfNotPresent
    tag: ""

  service:
    type: ClusterIP
    port: 9080

  resources:
    limits:
      cpu: 2000m
      memory: 2Gi
    requests:
      cpu: 1000m
      memory: 1Gi

  autoscaling:
    enabled: false

# PostgreSQL (using Bitnami chart)
postgresql:
  enabled: true
  auth:
    username: sovereignrag
    password: "" # Set via --set or secrets
    database: sovereignrag

  primary:
    persistence:
      enabled: true
      size: 100Gi
      storageClass: ""
    resources:
      limits:
        cpu: 4000m
        memory: 8Gi
      requests:
        cpu: 2000m
        memory: 4Gi
    initdb:
      scripts:
        init.sql: |
          CREATE SCHEMA IF NOT EXISTS master;
          CREATE SCHEMA IF NOT EXISTS core;
          CREATE SCHEMA IF NOT EXISTS identity;
          CREATE SCHEMA IF NOT EXISTS audit;
          CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
          CREATE EXTENSION IF NOT EXISTS "pgcrypto";

  readReplicas:
    replicaCount: 2
    persistence:
      enabled: true
      size: 100Gi
    resources:
      limits:
        cpu: 2000m
        memory: 4Gi
      requests:
        cpu: 1000m
        memory: 2Gi

  metrics:
    enabled: true
    serviceMonitor:
      enabled: true

# Redis (using Bitnami chart)
redis:
  enabled: true
  auth:
    password: "" # Set via --set or secrets

  master:
    persistence:
      enabled: true
      size: 10Gi
    resources:
      limits:
        cpu: 1000m
        memory: 2Gi
      requests:
        cpu: 500m
        memory: 1Gi

  replica:
    replicaCount: 2
    persistence:
      enabled: true
      size: 10Gi

  metrics:
    enabled: true
    serviceMonitor:
      enabled: true

# Ollama (LLM service)
ollama:
  enabled: true
  replicaCount: 1
  image:
    repository: ollama/ollama
    pullPolicy: IfNotPresent
    tag: latest

  service:
    type: ClusterIP
    port: 11434

  persistence:
    enabled: true
    size: 100Gi
    storageClass: ""

  resources:
    limits:
      nvidia.com/gpu: 1
      cpu: 4000m
      memory: 16Gi
    requests:
      nvidia.com/gpu: 1
      cpu: 2000m
      memory: 8Gi

  models:
    - gpt-oss:20b-cloud
    - jeffh/intfloat-multilingual-e5-large:q8_0

  nodeSelector:
    nvidia.com/gpu: "true"

  tolerations:
    - key: nvidia.com/gpu
      operator: Exists
      effect: NoSchedule

# Monitoring
monitoring:
  enabled: true
  prometheus:
    enabled: true
  grafana:
    enabled: true
    adminPassword: "" # Set via --set or secrets

# Security
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false

# Service Account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Network Policies
networkPolicy:
  enabled: false

# Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1
